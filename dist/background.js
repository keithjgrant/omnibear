(function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.i=function(t){return t},r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=25)})([,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.NEW_NOTE="new-note",e.PAGE_REPLY="page-reply",e.ITEM_REPLY="item-reply",e.MESSAGE_SUCCESS="success",e.MESSAGE_ERROR="error",e.DEFAULT_REACJI=["ðŸ‘","ðŸ‘Ž","ðŸŽ‰","ðŸ˜†","ðŸ˜¢","ðŸ˜ "]},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getLogs=s,e.clearLogs=function(){localStorage.setItem("log","[]")},e.info=u,e.warning=function(t,e){c(t,e,i)},e.error=function(t,e){c(t,e,a)};var n=r(5),o="info",i="warning",a="error";function s(){var t=JSON.parse(localStorage.getItem("log"));return t||[]}function c(t,e,r){if((0,n.getSettings)().debugLog||r===a){var o=s();o.length>100&&o.unshift();var i,c={message:t,type:r,timestamp:(i=new Date,i.getDate()+"/"+(i.getMonth()+1)+"/"+i.getFullYear()+" "+i.getHours()+":"+i.getMinutes()+":"+i.getSeconds()+"."+i.getMilliseconds())};e&&(e instanceof Error?c.data={message:e.message,stack:e.stack.trim().split("\n")}:c.data=e),o.push(c),function(t){localStorage.setItem("log",JSON.stringify(t))}(o)}}function u(t,e){c(t,e,o)}e.default=u},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.openLink=function(t){t.preventDefault(),t.target.href&&chrome.tabs.create({url:t.target.href})},e.clone=function(t){return JSON.parse(JSON.stringify(t))},e.getAuthTab=function(){return new Promise(function(t,e){chrome.tabs.query({url:"https://omnibear.com/auth/success*"},function(r){r.length?t(r[0]):e("Auth tab not found")})})},e.logout=function(){["token","domain","authEndpoint","tokenEndpoint","micropubEndpoint"].map(function(t){return localStorage.removeItem(t)})},e.generateSlug=function(t){var e=t.toLocaleLowerCase().trim();e=e.replace(/\s/g,"-");for(var r=0,a=o.length;r<a;r++)e=e.replace(new RegExp(o.charAt(r),"g"),i.charAt(r));return(e=(e=e.replace(n,"")).replace(/\-\-+/g,"-")).split("-").splice(0,6).join("-")},e.getPageUrl=function(){return new Promise(function(t,e){var r=localStorage.getItem("pageTabId");chrome.tabs.get(Number(r),function(e){t(e.url)})})};var n=/[^A-Za-z0-9\-]/g,o="Ã¡Ã¤Ã¢Ã Ã£Ã¥ÄÃ§Ä‡ÄÃ©Ä›Ã«Ã¨Ãªáº½Ä•È‡Ä™Ä—Ã­Ã¬Ã®Ã¯ÅˆÃ±Ã³Ã¶Ã²Ã´ÃµÃ¸Ã°Å™Å•Å¡Å¥ÃºÅ¯Ã¼Ã¹Ã»Ã½Ã¿Å¾Ã¾ÃžÄÄ‘ÃŸÃ†aÂ·/_,:;",i="aaaaaacccdeeeeeeeeeeiiiinnooooooorrstuuuuuyyzbBDdBAa------"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,o=r(17),i=(n=o)&&n.__esModule?n:{default:n};e.default=new i.default({clientId:"https://omnibear.com",redirectUri:"https://omnibear.com/auth/success/",state:"very-secret-omnibear-state",me:localStorage.getItem("domain"),authEndpoint:localStorage.getItem("authEndpoint"),tokenEndpoint:localStorage.getItem("tokenEndpoint"),micropubEndpoint:localStorage.getItem("micropubEndpoint"),token:localStorage.getItem("token")})},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getSettings=function(){var t=JSON.parse(localStorage.getItem("settings"));if(t)return t;return s},e.saveSettings=function(t){var e={};a.forEach(function(r){e[r]=t[r]}),localStorage.setItem("settings",JSON.stringify(e))},e.saveAuthenticationDetails=function(t,e,r){t&&(localStorage.setItem("domain",t),i.default.options.me=t);e&&(localStorage.setItem("token",e),i.default.options.token=e);r&&(localStorage.setItem("micropubEndpoint",r),i.default.options.micropubEndpoint=r)},e.getSyndicateOptions=function(){var t=localStorage.getItem("syndicateTo");return t&&"undefined"!==t?JSON.parse(t):(localStorage.setItem("syndicateTo","[]"),[])};var n,o=r(4),i=(n=o)&&n.__esModule?n:{default:n};var a=["defaultToCurrentPage","autoSlug","closeAfterPosting","debugLog","reacji","slug","syndicateTo"],s={defaultToCurrentPage:!1,autoSlug:!1,closeAfterPosting:!0,debugLog:!1,reacji:r(1).DEFAULT_REACJI,slug:"mp-slug",syndicateTo:"mp-syndicate-to"}},function(t,e,r){"use strict";var n=String.prototype.replace,o=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(t){return n.call(t,o,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(t,e,r){"use strict";var n=Object.prototype.hasOwnProperty,o=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),i=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r};t.exports={arrayToObject:i,assign:function(t,e){return Object.keys(e).reduce(function(t,r){return t[r]=e[r],t},t)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var o=e[n],i=o.obj[o.prop],a=Object.keys(i),s=0;s<a.length;++s){var c=a[s],u=i[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(e.push({obj:i,prop:c}),r.push(u))}return function(t){for(var e;t.length;){var r=t.pop();if(e=r.obj[r.prop],Array.isArray(e)){for(var n=[],o=0;o<e.length;++o)void 0!==e[o]&&n.push(e[o]);r.obj[r.prop]=n}}return e}(e)},decode:function(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(e){return t}},encode:function(t){if(0===t.length)return t;for(var e="string"==typeof t?t:String(t),r="",n=0;n<e.length;++n){var i=e.charCodeAt(n);45===i||46===i||95===i||126===i||i>=48&&i<=57||i>=65&&i<=90||i>=97&&i<=122?r+=e.charAt(n):i<128?r+=o[i]:i<2048?r+=o[192|i>>6]+o[128|63&i]:i<55296||i>=57344?r+=o[224|i>>12]+o[128|i>>6&63]+o[128|63&i]:(n+=1,i=65536+((1023&i)<<10|1023&e.charCodeAt(n)),r+=o[240|i>>18]+o[128|i>>12&63]+o[128|i>>6&63]+o[128|63&i])}return r},isBuffer:function(t){return null!==t&&void 0!==t&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,r,o){if(!r)return e;if("object"!=typeof r){if(Array.isArray(e))e.push(r);else{if("object"!=typeof e)return[e,r];(o.plainObjects||o.allowPrototypes||!n.call(Object.prototype,r))&&(e[r]=!0)}return e}if("object"!=typeof e)return[e].concat(r);var a=e;return Array.isArray(e)&&!Array.isArray(r)&&(a=i(e,o)),Array.isArray(e)&&Array.isArray(r)?(r.forEach(function(r,i){n.call(e,i)?e[i]&&"object"==typeof e[i]?e[i]=t(e[i],r,o):e.push(r):e[i]=r}),e):Object.keys(r).reduce(function(e,i){var a=r[i];return n.call(e,i)?e[i]=t(e[i],a,o):e[i]=a,e},a)}}},,function(t,e,r){var n,o,i,a;i=function(){var t=/^;\s*([^"=]+)=(?:"([^"]+)"|([^";,]+)(?:[;,]|$))/,e=/^<([^>]*)>/,r=/^\s*,\s*/;return{parse:function(n,o){for(var i,a,s,c=o&&o.extended||!1,u=[];n&&(n=n.trim(),a=e.exec(n));){for(var l={link:a[1]},p=(n=n.slice(a[0].length)).match(r);n&&(!p||p.index>0)&&(i=t.exec(n));)p=(n=n.slice(i[0].length)).match(r),"rel"===i[1]||"rev"===i[1]?(s=(i[2]||i[3]).split(/\s+/),l[i[1]]=s):l[i[1]]=i[2]||i[3];u.push(l),n=n.replace(r,"")}return c?u:u.reduce(function(t,e){return e.rel&&e.rel.forEach(function(r){t[r]=e.link}),t},{})},stringify:function(t){var e=Object.keys(t).reduce(function(e,r){return e[t[r]]=e[t[r]]||[],e[t[r]].push(r),e},{});return Object.keys(e).reduce(function(t,r){return t.concat("<"+r+'>; rel="'+e[r].join(" ")+'"')},[]).join(", ")}}},a=this,void 0!==t&&t.exports?t.exports=i():"function"==typeof a.define&&a.define.amd?void 0===(o="function"==typeof(n=i)?n.call(e,r,e,t):n)||(t.exports=o):a.li=i()},function(t,e,r){"use strict";var n=r(12),o=r(11),i=r(6);t.exports={formats:i,parse:o,stringify:n}},function(t,e,r){"use strict";var n=r(7),o=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},a=function(t,e,r){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(n),s=a?n.slice(0,a.index):n,c=[];if(s){if(!r.plainObjects&&o.call(Object.prototype,s)&&!r.allowPrototypes)return;c.push(s)}for(var u=0;null!==(a=i.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(t,e,r){for(var n=e,o=t.length-1;o>=0;--o){var i,a=t[o];if("[]"===a)i=(i=[]).concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n}n=i}return n}(c,e,r)}};t.exports=function(t,e){var r=e?n.assign({},e):{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.ignoreQueryPrefix=!0===r.ignoreQueryPrefix,r.delimiter="string"==typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:i.delimiter,r.depth="number"==typeof r.depth?r.depth:i.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:i.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:i.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:i.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:i.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:i.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:i.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:i.strictNullHandling,""===t||null===t||void 0===t)return r.plainObjects?Object.create(null):{};for(var s="string"==typeof t?function(t,e){for(var r={},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,a=e.parameterLimit===1/0?void 0:e.parameterLimit,s=n.split(e.delimiter,a),c=0;c<s.length;++c){var u,l,p=s[c],d=p.indexOf("]="),f=-1===d?p.indexOf("="):d+1;-1===f?(u=e.decoder(p,i.decoder),l=e.strictNullHandling?null:""):(u=e.decoder(p.slice(0,f),i.decoder),l=e.decoder(p.slice(f+1),i.decoder)),o.call(r,u)?r[u]=[].concat(r[u]).concat(l):r[u]=l}return r}(t,r):t,c=r.plainObjects?Object.create(null):{},u=Object.keys(s),l=0;l<u.length;++l){var p=u[l],d=a(p,s[p],r);c=n.merge(c,d,r)}return n.compact(c)}},function(t,e,r){"use strict";var n=r(7),o=r(6),i={brackets:function(t){return t+"[]"},indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},a=Date.prototype.toISOString,s={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(t){return a.call(t)},skipNulls:!1,strictNullHandling:!1},c=function t(e,r,o,i,a,c,u,l,p,d,f,h){var g=e;if("function"==typeof u)g=u(r,g);else if(g instanceof Date)g=d(g);else if(null===g){if(i)return c&&!h?c(r,s.encoder):r;g=""}if("string"==typeof g||"number"==typeof g||"boolean"==typeof g||n.isBuffer(g))return c?[f(h?r:c(r,s.encoder))+"="+f(c(g,s.encoder))]:[f(r)+"="+f(String(g))];var m,y=[];if(void 0===g)return y;if(Array.isArray(u))m=u;else{var b=Object.keys(g);m=l?b.sort(l):b}for(var v=0;v<m.length;++v){var k=m[v];a&&null===g[k]||(y=Array.isArray(g)?y.concat(t(g[k],o(r,k),o,i,a,c,u,l,p,d,f,h)):y.concat(t(g[k],r+(p?"."+k:"["+k+"]"),o,i,a,c,u,l,p,d,f,h)))}return y};t.exports=function(t,e){var r=t,a=e?n.assign({},e):{};if(null!==a.encoder&&void 0!==a.encoder&&"function"!=typeof a.encoder)throw new TypeError("Encoder has to be a function.");var u=void 0===a.delimiter?s.delimiter:a.delimiter,l="boolean"==typeof a.strictNullHandling?a.strictNullHandling:s.strictNullHandling,p="boolean"==typeof a.skipNulls?a.skipNulls:s.skipNulls,d="boolean"==typeof a.encode?a.encode:s.encode,f="function"==typeof a.encoder?a.encoder:s.encoder,h="function"==typeof a.sort?a.sort:null,g=void 0!==a.allowDots&&a.allowDots,m="function"==typeof a.serializeDate?a.serializeDate:s.serializeDate,y="boolean"==typeof a.encodeValuesOnly?a.encodeValuesOnly:s.encodeValuesOnly;if(void 0===a.format)a.format=o.default;else if(!Object.prototype.hasOwnProperty.call(o.formatters,a.format))throw new TypeError("Unknown format option provided.");var b,v,k=o.formatters[a.format];"function"==typeof a.filter?r=(v=a.filter)("",r):Array.isArray(a.filter)&&(b=v=a.filter);var E,O=[];if("object"!=typeof r||null===r)return"";E=a.arrayFormat in i?a.arrayFormat:"indices"in a?a.indices?"indices":"repeat":"indices";var j=i[E];b||(b=Object.keys(r)),h&&b.sort(h);for(var w=0;w<b.length;++w){var S=b[w];p&&null===r[S]||(O=O.concat(c(r[S],S,j,l,p,d?f:null,v,h,g,m,k,y)))}var A=O.join(u),x=!0===a.addQueryPrefix?"?":"";return A.length>0?x+A:""}},function(t,e,r){"use strict";var n=r(10);r.n(n);r.o(n,"parse")&&r.d(e,"a",function(){return n.parse}),r.o(n,"stringify")&&r.d(e,"c",function(){return n.stringify});var o=r(9),i=r.n(o);r.d(e,"f",function(){return i.a});var a=r(16);r.d(e,"b",function(){return a.a});var s=r(15);r.d(e,"d",function(){return s.a});var c=r(14);r.d(e,"e",function(){return c.a})},function(t,e,r){"use strict";e.a=function(t,e){const r=-1==t.indexOf("?")?"?":"&";let n=[];for(var o in e)Array.isArray(e[o])?e[o].forEach(t=>{n.push(o+"[]="+encodeURIComponent(t))}):n.push(o+"="+encodeURIComponent(e[o]));const i=n.join("&");return t+r+i}},function(t,e,r){"use strict";e.a=function t(e,r=new FormData,n=!1){Object.keys(e).forEach(o=>{const i=e[o];n&&(o=n+"["+o+"]"),Array.isArray(i)?i.forEach(e=>{const n={};n[o+"[]"]=e,r=t(n,r)}):r.append(o,i)});return r}},function(t,e,r){"use strict";e.a=function(t,e){let r={},n=e;const o=(new DOMParser).parseFromString(t,"text/html"),i=o.querySelector("base[href]"),a=o.querySelectorAll("[rel][href]");if(i){const t=i.getAttribute("href"),r=new URL(t,e);n=r.toString()}return a.length&&a.forEach(t=>{const e=t.getAttribute("rel").toLowerCase().split("\\s+"),o=t.getAttribute("href");e.length&&null!==o&&e.forEach(t=>{r[t]||(r[t]=[]);const e=new URL(o,n).toString();-1===r[t].indexOf(e)&&r[t].push(e)})}),r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){var n=r(13);const o=n.a,i=n.b,a=n.c,s=n.d,c=n.e,u=n.f.parse;n.FormData&&!t.FormData&&(t.FormData=n.FormData),n.DOMParser&&!t.DOMParser&&(t.DOMParser=n.DOMParser),n.URL&&!t.URL&&(t.URL=n.URL);const l={me:"",scope:"post create delete update",token:"",authEndpoint:"",tokenEndpoint:"",micropubEndpoint:""},p=(t,e=null,r=null)=>({message:t,status:e,error:r});e.default=class{constructor(t={}){this.options=Object.assign({},l,t),this.create=this.create.bind(this),this.update=this.update.bind(this),this.delete=this.delete.bind(this),this.undelete=this.undelete.bind(this),this.postMicropub=this.postMicropub.bind(this),this.checkRequiredOptions=this.checkRequiredOptions.bind(this),this.getAuthUrl=this.getAuthUrl.bind(this),this.getEndpointsFromUrl=this.getEndpointsFromUrl.bind(this)}checkRequiredOptions(t){let e=[],r=!0;for(var n=0;n<t.length;n++){const o=t[n];this.options[o]||(r=!1,e.push(o))}return{pass:r,missing:e}}getEndpointsFromUrl(t){return new Promise((e,r)=>{let n={micropub:null,authorization_endpoint:null,token_endpoint:null},o=t;fetch(t).then(t=>{if(!t.ok)return r(p("Error getting page",t.status));o=t.url;const e=t.headers.get("link");if(e){const t=u(e);Object.keys(n).forEach(e=>{t[e]&&(n[e]=t[e])})}return t.text()}).then(a=>{const s=i(a,o);return this.options.me=t,s&&Object.keys(n).forEach(t=>{s[t]&&s[t][0]&&(n[t]=s[t][0])}),n.micropub&&n.authorization_endpoint&&n.token_endpoint?(this.options.micropubEndpoint=n.micropub,this.options.tokenEndpoint=n.token_endpoint,this.options.authEndpoint=n.authorization_endpoint,e({auth:this.options.authEndpoint,token:this.options.tokenEndpoint,micropub:this.options.micropubEndpoint})):r(p("Error getting microformats data"))}).catch(t=>r(p("Error fetching url",null,t)))})}getToken(t){return new Promise((e,r)=>{const n=this.checkRequiredOptions(["me","clientId","redirectUri","tokenEndpoint"]);if(!n.pass)return r(p("Missing required options: "+n.missing.join(", ")));const i={grant_type:"authorization_code",me:this.options.me,code:t,client_id:this.options.clientId,redirect_uri:this.options.redirectUri},s={method:"POST",body:a(i),headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"}};fetch(this.options.tokenEndpoint,s).then(t=>{if(!t.ok)return r(p("Error getting token",t.status));const e=t.headers.get("Content-Type");return e&&0===e.indexOf("application/json")?t.json():t.text()}).then(t=>("string"==typeof t&&(t=o(t)),t.error_description?r(p(t.error_description)):t.error?r(p(t.error)):t.me&&t.scope&&t.access_token?t.me&&t.me.replace(/\/+$/,"")!==this.options.me.replace(/\/+$/,"")?r(p("The me values did not match")):(this.options.token=t.access_token,void e(t.access_token)):r(p("The token endpoint did not return the expected parameters")))).catch(t=>r(p("Error requesting token endpoint",null,t)))})}getAuthUrl(){return new Promise((t,e)=>{let r=this.checkRequiredOptions(["me","state"]);if(!r.pass)return e(p("Missing required options: "+r.missing.join(", ")));this.getEndpointsFromUrl(this.options.me).then(()=>{let r=this.checkRequiredOptions(["me","state","scope","clientId","redirectUri"]);if(!r.pass)return e(p("Missing required options: "+r.missing.join(", ")));const n={me:this.options.me,client_id:this.options.clientId,redirect_uri:this.options.redirectUri,response_type:"code",scope:this.options.scope,state:this.options.state};t(this.options.authEndpoint+"?"+a(n))}).catch(t=>e(p("Error getting auth url",null,t)))})}verifyToken(){return new Promise((t,e)=>{const r=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!r.pass)return e(p("Missing required options: "+r.missing.join(", ")));const n={method:"GET",headers:{Authorization:"Bearer "+this.options.token}};fetch(this.options.micropubEndpoint,n).then(r=>r.ok?t(!0):e(p("Error verifying token",r.status))).catch(t=>e(p("Error verifying token",null,t)))})}create(t,e="json"){return this.postMicropub(t,e)}update(t,e){return this.postMicropub(Object.assign({action:"update",url:t},e))}delete(t){return this.postMicropub({action:"delete",url:t})}undelete(t){return this.postMicropub({action:"undelete",url:t})}postMicropub(t,e="json"){return new Promise((r,n)=>{const i=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!i.pass)return n(p("Missing required options: "+i.missing.join(", ")));let c={method:"POST"};"json"==e?(c.body=JSON.stringify(t),c.headers={Authorization:"Bearer "+this.options.token,"Content-Type":"application/json",Accept:"application/json, application/x-www-form-urlencoded"}):"form"==e?(c.body=a(t,{arrayFormat:"brackets"}),c.headers={Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json, application/x-www-form-urlencoded"}):"multipart"==e&&(c.body=s(t),c.headers={Authorization:"Bearer "+this.options.token,Accept:"application/json, application/x-www-form-urlencoded"}),fetch(this.options.micropubEndpoint,c).then(t=>{if(!t.ok)return n(p("Error with micropub request",t.status));const e=t.headers.get("Location")||t.headers.get("location");if(e)return r(e);const o=t.headers.get("Content-Type");return o&&0===o.indexOf("application/json")?t.json():t.text()}).then(t=>("string"==typeof t&&(t=o(t)),t.error_description?n(p(t.error_description)):t.error?n(p(t.error)):r(t))).catch(t=>n(p("Error sending request",null,t)))})}postMedia(t){return new Promise((e,r)=>{const n=this.checkRequiredOptions(["token","mediaEndpoint"]);if(!n.pass)return r(p("Missing required options: "+n.missing.join(", ")));let o={method:"POST",body:s({file:t}),headers:{Authorization:"Bearer "+this.options.token,Accept:"*/*"}};fetch(this.options.mediaEndpoint,o).then(t=>{if(201!==t.status)return r(p("Error creating media",t.status));const n=t.headers.get("Location")||t.headers.get("location");return n?e(n):r(p("Media endpoint did not return a location",t.status))}).catch(t=>r(p("Error sending request")))})}query(t){return new Promise((e,r)=>{const n=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!n.pass)return r(p("Missing required options: "+n.missing.join(", ")));const o=c(this.options.micropubEndpoint,{q:t}),i={method:"GET",headers:{Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"}};fetch(o,i).then(e=>e.ok?e.json():r(p("Error getting "+t,e.status))).then(t=>e(t)).catch(e=>r(p("Error getting "+t,null,e)))})}querySource(t,e=[]){return new Promise((r,n)=>{const o=this.checkRequiredOptions(["token","micropubEndpoint"]);if(!o.pass)return n(p("Missing required options: "+o.missing.join(", ")));t=c(this.options.micropubEndpoint,{q:"source",url:t,properties:e});const i={method:"GET",headers:{Authorization:"Bearer "+this.options.token,"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8",Accept:"application/json"}};fetch(t,i).then(t=>t.ok?t.json():n(p("Error getting source",t.status))).then(t=>r(t)).catch(t=>n(p("Error getting source",null,t)))})}}}.call(e,r(18))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getParamFromUrl=function(t,e){var r=e.split("?")[1];return a(t,r)},e.getParamFromUrlString=a,e.cleanParams=s,e.paramsToQueryString=c,e.getUrlOrigin=function(t){var e=(0,i.default)(t);return[e.protocol,"://",e.host,e.port?":"+e.port:""].join("")},e.cleanUrl=function(t){var e=(0,i.default)(t);return[e.protocol,"://",e.host,e.port?":"+e.port:"",e.path,c(s(e.queryKey))].join("")};var n,o=r(46),i=(n=o)&&n.__esModule?n:{default:n};function a(t,e){var r=e.split("&").filter(function(e){return e.startsWith(t+"=")});if(r&&r.length){var n=r[0].substr(t.length+1);return decodeURIComponent(n)}return null}function s(t){var e={};for(var r in t)r.startsWith("utm_")||(e[r]=t[r]);return e}function c(t){var e=[];for(var r in t)e.push(r+"="+t[r]);return e.length?"?"+e.join("&"):""}},,,function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.fetchToken=function(t){return i.default.options.me=localStorage.getItem("domain"),i.default.options.tokenEndpoint=localStorage.getItem("tokenEndpoint"),i.default.options.micropubEndpoint=localStorage.getItem("micropubEndpoint"),i.default.getToken(t).then(function(t){if(!t)throw new Error("Token not found in token endpoint response. Missing expected field `access_token`");localStorage.setItem("token",t),i.default.options.token=t}).catch(function(t){(0,s.error)("Error fetching token",t),(0,a.getAuthTab)().then(function(e){chrome.tabs.sendMessage(e.id,{action:"fetch-token-error",payload:{error:t}}),(0,a.logout)()})})},e.fetchSyndicationTargets=function(){return i.default.query("syndicate-to").then(function(t){var e=t["syndicate-to"];(0,s.info)("Syndication targets retreived",e),Array.isArray(e)?localStorage.setItem("syndicateTo",JSON.stringify(e)):((0,s.warning)("Syndication targets not in array format. Saving as empty array."),localStorage.setItem("syndicateTo",JSON.stringify([])))})};var n,o=r(4),i=(n=o)&&n.__esModule?n:{default:n},a=(r(19),r(3)),s=r(2)},,,function(t,e,r){"use strict";var n=r(19),o=r(22),i=(r(3),r(2)),a=null;function s(t){localStorage.setItem("selectedEntry",t)}function c(){localStorage.removeItem("selectedEntry")}chrome.runtime.onMessage.addListener(function(t,e,r){switch(t.action){case"begin-auth":l=t.payload,localStorage.setItem("domain",l.domain),localStorage.setItem("authEndpoint",l.metadata.authEndpoint),localStorage.setItem("tokenEndpoint",l.metadata.tokenEndpoint),localStorage.setItem("micropubEndpoint",l.metadata.micropub),chrome.tabs.create({url:l.authUrl},function(t){a=t.id});break;case"focus-window":o=e.tab.id,i=e.url,u=t.payload.selectedEntry,localStorage.setItem("pageUrl",(0,n.cleanUrl)(i)),localStorage.setItem("pageTabId",o),u?s(u):c();break;case"select-entry":s(t.payload.url);break;case"clear-entry":c()}var o,i,u,l}),chrome.tabs.onUpdated.addListener(function(t,e,r){if(t===a&&function(t){return t.url&&t.url.startsWith("https://omnibear.com/auth/success")}(e)){var s=(0,n.getParamFromUrl)("code",e.url);(0,i.info)("Auth code found beginning '"+s.substr(0,6)+"'. Fetching tokenâ€¦"),(0,o.fetchToken)(s).then(function(){return(0,i.info)("Token retrieved. Fetching syndication targetsâ€¦"),(0,o.fetchSyndicationTargets)()}).then(function(){(0,i.info)("Authentication complete. Closing authentication tab."),chrome.tabs.remove(r.id),a=null}).catch(function(t){(0,i.error)(t.message,t)})}}),chrome.contextMenus.create({title:"Reply to entry",contexts:["page","selection"],onclick:function(){"undefined"==typeof browser?window.open("index.html?reply=true","extension_popup","width=450,height=510,status=no,scrollbars=yes,resizable=no,top=80,left=2000"):browser.windows.create({url:"index.html?reply=true",width:450,height:580,type:"panel",left:2e3})}})},,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";t.exports=function(t,e){e=e||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[e.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(t,e,n){e&&(o[r.q.name][e]=n)}),o}}]);